<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disaster Relief</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/css/home.css">
    <link rel="stylesheet" href="/css/emergency.css">
    <link rel="stylesheet" href="/css/header.css">
    
    <style>
    canvas {
        max-height: 600px;
      max-width: 500px;
      margin-left: 17rem;
    }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> 
</head>
<body class="bg-grey-100" id="chamchamcham">
    
    <%- include('../partials/navbar') %>
<br><br>
  <%-include('../partials/emergency')%>
  <%- include('../partials/header')%>
  <%- include('../partials/services')%>
  <%- include('../partials/graphs')%>
  <%- include('../partials/FAQ')%>
  <%- include('../partials/contactUs') %>
  <%- include('../partials/aboutUs') %>
  <%- include('../partials/footer') %>


<script>
  const contactList = JSON.parse(localStorage.getItem('emergencyContacts')) || [];

  // Toggle the emergency menu visibility
  document.getElementById('emergency-btn').addEventListener('click', function () {
    document.getElementById('menu').classList.toggle('active');
  });

  // Open Contact Selection for Voice Call, Video Call, etc.
  const openContactSelection = (option) => {
    const contactListContainer = document.getElementById('contact-list');
    contactListContainer.innerHTML = ''; // Clear previous contact list

    if (contactList.length === 0) {
      contactListContainer.innerHTML = '<li>No contacts saved</li>';
    } else {
      contactList.forEach(contact => {
        const li = document.createElement('li');
        li.innerHTML = `${contact.name} (${contact.phone}) 
                          <span class="select-option" data-option="${option}" data-contact="${contact.phone}">Select</span>
                          <span class="remove-number" data-contact="${contact.phone}">Ã—</span>`;
        contactListContainer.appendChild(li);
      });
    }

    document.getElementById('contact-selection').style.display = 'block';
  };

  // Select an emergency contact
  document.getElementById('contact-list').addEventListener('click', function (event) {
    if (event.target.classList.contains('select-option')) {
      const contactPhone = event.target.dataset.contact;
      const option = event.target.dataset.option;

      // Perform the action once the contact is selected
      alert(`${option.charAt(0).toUpperCase() + option.slice(1)} to ${contactPhone}`);
      document.getElementById('contact-selection').style.display = 'none';
    }

    if (event.target.classList.contains('remove-number')) {
      const contactPhone = event.target.dataset.contact;
      removeContact(contactPhone);
    }
  });

  // Close Contact Selection
  document.getElementById('close-contact-selection').addEventListener('click', function () {
    document.getElementById('contact-selection').style.display = 'none';
  });

  // Add New Emergency Number
  document.getElementById('add-remove-number').addEventListener('click', function () {
    document.getElementById('add-number-modal').style.display = 'block';
  });

  // Save the new contact to Local Storage
  document.getElementById('save-contact').addEventListener('click', function () {
    const name = document.getElementById('contact-name').value;
    const phone = document.getElementById('contact-phone').value;
    if (name && phone) {
      contactList.push({ name, phone });
      localStorage.setItem('emergencyContacts', JSON.stringify(contactList));
      alert('Contact saved successfully!');
      document.getElementById('contact-name').value = '';
      document.getElementById('contact-phone').value = '';
      document.getElementById('add-number-modal').style.display = 'none';
    } else {
      alert('Please enter both name and phone number');
    }
  });

  // Close Add Contact Modal
  document.getElementById('close-add-modal').addEventListener('click', function () {
    document.getElementById('add-number-modal').style.display = 'none';
  });

  // Remove a Contact from Local Storage
  const removeContact = (phone) => {
    // Filter out the contact by phone number
    const updatedContacts = contactList.filter(contact => contact.phone !== phone);
    
    // Update localStorage with the new list
    localStorage.setItem('emergencyContacts', JSON.stringify(updatedContacts));

    // Update the contact list in the DOM
    alert('Contact removed successfully!');
    document.getElementById('contact-selection').style.display = 'none';
    openContactSelection(); // Refresh the contact list
  };

  // Functionality for each of the options (Voice Call, Video Call, etc.)
  const handleOptionSelection = (option) => {
    if (contactList.length === 0) {
      alert('No contacts available. Please add an emergency contact first.');
    } else {
      alert(`You have selected ${option}. Now you can choose a contact.`);
      openContactSelection(option);
    }
  };

  document.getElementById('voice-call').addEventListener('click', () => handleOptionSelection('Voice Call'));
  document.getElementById('video-call').addEventListener('click', () => handleOptionSelection('Video Call'));
  document.getElementById('send-voice').addEventListener('click', () => handleOptionSelection('Send Voice'));
  document.getElementById('send-location').addEventListener('click', () => handleOptionSelection('Send Location'));

</script>

  <script src="../public/js/homeChatBot.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
